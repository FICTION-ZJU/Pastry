# Instructions on running benchmarks with Absynth

This file contains instructions for the artifact evaluation of our CAV'25 paper:

> Sergei Novozhilov, Mingqi Yang, Mingshuai Chen, Zhiyang Li, Jianwei Yin:
On the Almost-Sure Termination of Probabilistic Counter Programs. In Proc. of CAV 2025.

In particular, we show how to reproduce the experimental results for Absynth (which does not have publicly available sources and thus cannot be reliably packaged via Docker).

## Contents
  - [Contents](#contents)
  - [Project Structure](#project-structure)
  - [Requirements](#requirements)
  - [Setup](#setup)
  - [Replicate the results from the paper](#replicate-the-results-from-the-paper)
  - [Merge result tables](#merge-result-tables)

## Artifact structure
The structure of the artifact is as follows.

```
./artifact-absynth
├── absynth          
│   ├── absynth      # Absynth executable
│   └── ...          # Other files
├── benchmarks       # Benchmarks in our paper for Absynth
├── result           # Result table generated by run.sh
├── merge_table.py   # A python script for merging two csv files to generate a merged table
├── README.md        # This file
├── run.py           # Helper script
└── run.sh           # Benchmarks runner script 
```

## Requirements
- Install Python 3 and Anaconda (https://www.anaconda.com/download). The latter can be installed by
```bash
brew install --cask anaconda
```
- Install coreutils (for the use of `gtimeout`):
```bash
brew install coreutils
```
- Experiments in the paper are conducted on a 3.22 GHz Apple M1 Pro processor with 16GB RAM running macOS Sonoma. Make sure to have similar specs when comparing timing results.



## Setup
1. Create a python virtual environment:
```bash
conda create --name absynth python=3.12 rich=13.3 pandas=2.1
```
2. Activate the virtual environment:
```bash
conda activate absynth
```
3. Resolve permission error (in case of any):

First try to run Absynth:
```bash
absynth/absynth -help
```
If you do not receive any error, just skip this step. Otherwise if you receive an error like `Apple could not verify "absynth" is free of malware...`, go to `System Settings -> Privacy & Security -> Security` and find the term `"absynth" was blocked to protect your Mac`. Click `Open Anyway` and run the command again:
```bash
absynth/absynth -help
```
In the pop-up window, click `Open Anyway` and input your system password if required.

## Replicate the results from the paper

Reproduce the results in Table 1 (the column of Absynth) by running the following command (which takes around 1 minute):

```bash
./run.sh --run-all -t 90
```


**The generated results** in CSV format can be found in `./result/absynth_all_experiment_data.csv`. The generated table matches (the Absynth column of) Table 1 in the paper, except for formatting differences and host-dependent time variations. The table entries can be (1) a floating-point number representing running time in seconds (in case of success), (2) "-" when Absynth does not support the corresponding benchmark, or (3) "TO" when the time limit (90 seconds) has been reached.


## Merge result tables

One can merge the result tables generated by artifact-main and artifact-absynth by the following command (suppose the input csv files are `result/all_experiment_data.csv` and `result/absynth_all_experiment_data.csv` respectively):
```bash 
python merge_table.py ./result/all_experiment_data.csv ./result/absynth_all_experiment_data.csv
```
One can also specify the output path by
```bash
python merge_table.py result/all_experiment_data.csv result/absynth_all_experiment_data.csv --outp
ut path/to/result/file
```
The default path is `./result/merged_all_experiment_data.csv`.
