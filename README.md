# Instructions on running benchmarks with Absynth

## Contents
- [Instructions on running benchmarks with Absynth](#instructions-on-running-benchmarks-with-absynth)
  - [Contents](#contents)
  - [Project Structure](#project-structure)
  - [Requirements](#requirements)
  - [Setup](#setup)
  - [Replicate the results from the paper](#replicate-the-results-from-the-paper)
  - [Merge result tables](#merge-result-tables)

## Project Structure
The structure of the artifact is as follows.

```
./artifact-absynth
├── absynth          # The Absynth executable etc. from the authors' website
│   ├── ansynth      # Absynth executable
│   └── ...          # Other files
├── benchmarks       # Benchmarks in our paper for Absynth
├── result           # Result table generated by run.sh
├── merge_table.py   # A python script for merging two csv files to generate a merged table
├── README.md        # This file
├── run.py           # Helper script
└── run.sh           # Benchmarks runner script 
```

## Requirements
- Install Python and Anaconda.
- Install coreutils to make sure `gtimeout` is available:
```bash
brew install coreutils
```
- Experiments in the paper are conducted on a 3.22 GHz Apple M1 Pro processor with 16GB RAM running macOS Sonoma. Make sure to have similar specs when comparing timing results.



## Setup
1. Create a python virtual environment:
```bash
conda create --name absynth python=3.12 rich=13.3 pandas=2.1
```
2. Activate the virtual environment:
```bash
conda activate absynth
```
3. Resolve permission error if any:

First try to run Absynth:
```bash
absynth/absynth -help
```
If you do not receive any error, just skip this step. Otherwise if you receive an error like `Apple could not verify "absynth" is free of malware...`, go to `System Settings -> Privacy & Security -> Security` and find the term `"absynth" was blocked to protect your Mac`. Click `Open Anyway` and run the command again:
```bash
absynth/absynth -help
```
In the pop-up window, click `Open Anyway` and input your system password if required.

## Replicate the results from the paper

Reproduce the results in Table 1 (the column of Absynth) by running the following command (which takes around 1 minute):

```bash
./run.sh --run-all -t 90
```


**The generated results** in CSV format can be found in `./result/absynth_all_experiment_data.csv`. The generated table matches (the Absynth part of) Table 1 in the paper, except for formatting differences and host-dependent time variations. The table entries can be (1) a floating-point number representing running time in seconds (in case of success), (2) "-" when Absynth does not support the corresponding benchmark, or (3) "TO" when the time limit (90 seconds) has been reached.

**Note:** The checkmarks and crossmarks in Table 1 are ground truth. One can verify these results by, e.g., running (only) Absynth on the benchmarks. For a specific benchmark (for example dir_term), one can run via

```bash
./run.sh --single dir_term
```

## Merge result tables

One can merge the result tables generated by artifact-main and artifact-absynth by the following command (suppose the input csv files are `result/all_experiment_data.csv` and `result/absynth_all_experiment_data.csv` respectively):
```bash 
python merge_table.py ./result/all_experiment_data.csv ./result/absynth_all_experiment_data.csv
```
One can also specify the output path by
```bash
python merge_table.py result/all_experiment_data.csv result/absynth_all_experiment_data.csv --outp
ut path/to/result/file
```
The default path is `./result/merged_all_experiment_data.csv`.