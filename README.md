# Instructions on running benchmarks with Absynth

This file contains instructions for the artifact evaluation of our CAV'25 paper:

> Sergei Novozhilov, Mingqi Yang, Mingshuai Chen, Zhiyang Li, Jianwei Yin:
On the Almost-Sure Termination of Probabilistic Counter Programs. In Proc. of CAV 2025.

In particular, we show how to reproduce the experimental results for Absynth (which does not have publicly available sources and thus cannot be reliably packaged via Docker).

## Contents
  - [Contents](#contents)
  - [Artifact structure](#artifact-structure)
  - [Requirements](#requirements)
  - [Setup](#setup)
  - [Replicate the results from the paper](#replicate-the-results-from-the-paper)
  - [Merge result tables](#merge-result-tables)
  - [Applendix](#applendix)

## Artifact structure
The structure of the artifact is as follows.

```
./artifact-absynth
├── absynth          
│   ├── absynth      # Absynth executable
│   └── ...          # Other files
├── benchmarks       # Benchmarks in our paper for Absynth
├── result           # Result table generated by run.sh
├── merge_table.py   # A python script for merging two csv files to generate a merged table
├── README.md        # This file
├── run.py           # Helper script
└── run.sh           # Benchmarks runner script 
```

## Requirements
- Install Python 3 and Anaconda. If you have not used conda before, refer to Applendix for a tutorial on installation and initialization.

- Install coreutils (for the use of `gtimeout`):
```bash
brew install coreutils
```
- Experiments in the paper are conducted on a 3.22 GHz Apple M1 Pro processor with 16GB RAM running macOS Sequoia. Make sure to have similar specs when comparing timing results.



## Setup
1. Create a python virtual environment:
```bash
conda create --name absynth python=3.12 rich=13.3 pandas=2.1
```
2. Activate the virtual environment:
```bash
conda activate absynth
```
3. Resolve permission error (in case of any):

First try to run Absynth:
```bash
absynth/absynth -help
```
If you do not receive any error, just skip this step. Otherwise if you receive an error like `Apple could not verify "absynth" is free of malware...`, go to `System Settings -> Privacy & Security -> Security` and find the term `"absynth" was blocked to protect your Mac`. Click `Open Anyway` and run the command again:
```bash
absynth/absynth -help
```
In the pop-up window, click `Open Anyway` and input your system password if required.

## Replicate the results from the paper

Reproduce the results in Table 1 (the column of Absynth) by running the following command (which takes around 1 minute):

```bash
./run.sh --run-all -t 90
```


**The generated results** in CSV format can be found in `./result/absynth_all_experiment_data.csv`. The generated table matches (the Absynth column of) Table 1 in the paper, except for formatting differences and host-dependent time variations. The table entries can be (1) a floating-point number representing running time in seconds (in case of success), (2) "-" when Absynth does not support the corresponding benchmark, or (3) "TO" when the time limit (90 seconds) has been reached.


## Merge result tables

One can merge the result tables generated by artifact-main and artifact-absynth by the following command (suppose the input csv files are `result/all_experiment_data.csv` and `result/absynth_all_experiment_data.csv` respectively):
```bash 
python merge_table.py ./result/all_experiment_data.csv ./result/absynth_all_experiment_data.csv
```
One can also specify the output path by
```bash
python merge_table.py result/all_experiment_data.csv result/absynth_all_experiment_data.csv --outp
ut path/to/result/file
```
The default path is `./result/merged_all_experiment_data.csv`.


## Applendix

### Install and initialize anaconda

The following steps shows how to install Anaconda via Homebrew Cask (First make sure you have homebrew installed)

#### (I) Update Homebrew and install the Anaconda Cask:  
```bash
brew update
brew install --cask anaconda
```
#### (II) Update `PATH`

By default, the Anaconda distribution will be installed to:
   - `/usr/local/anaconda3` on Intel Macs  
   - `/opt/homebrew/anaconda3` on Apple Silicon Macs

To make the `conda` command available in your shell, you must prepend the Anaconda `bin` directory to your `PATH`. This involves editing your shell’s startup file.

i) For Bash users (`~/.bash_profile` or `~/.bashrc`):

- Open your Bash startup file in a text editor, for example:
```bash
vim ~/.bash_profile
```
- Add the following line:
On Intel Macs:  
```bash
export PATH="/usr/local/anaconda3/bin:$PATH"
```  
&ensp;&ensp;Or for Apple Silicon:  
```bash
export PATH="/opt/homebrew/anaconda3/bin:$PATH"
```
- Save and source the file:  
```bash
source ~/.bash_profile
```

ii) For Zsh users (`~/.zshrc`):

- Open Zsh config file:  
```bash
vim ~/.zshrc
```  
- Add the following line:  
On Intel Macs:
```bash
export PATH="/usr/local/anaconda3/bin:$PATH"
```  
&ensp;&ensp;Or for Apple Silicon:  
```bash
export PATH="/opt/homebrew/anaconda3/bin:$PATH"
```
- Apply changes:  
```bash
source ~/.zshrc
```

iii) For Fish Shell users (`~/.config/fish/config.fish`):

- Open Fish config file:  
```bash
vim ~/.config/fish/config.fish
```  
- Add the following line:  
On Intel Macs:  
```fish
set -gx PATH /usr/local/anaconda3/bin $PATH
```  
&ensp;&ensp;Or for Apple Silicon:  
```fish
set -gx PATH /opt/homebrew/anaconda3/bin $PATH
```  
- Reload Fish config:  
```bash
source ~/.config/fish/config.fish
```

#### (III) Initialize Conda for Your Shell

- In Terminal, execute:
```bash
conda init --all
```

- After running `conda init`, close and reopen your Terminal to load the changes.
